/* NebulaDesktop Theme Bridge
 * Bridges the enhanced theme system with legacy window/component styling
 * Ensures all themes work consistently across windows and components
 */

/* =============================================================================
 * ENHANCED THEME TO LEGACY MAPPING
 * Maps new enhanced themes to work with existing window manager styles
 * ============================================================================= */

/* Core Legacy Variables - Applied to all themes */
:root {
    /* Ensure core Nebula variables exist for legacy components */
    --nebula-primary: #667eea;
    --nebula-secondary: #764ba2;
    --nebula-accent: #4f46e5;
    --nebula-success: #10b981;
    --nebula-warning: #f59e0b;
    --nebula-danger: #ef4444;
    
    /* Legacy animation variables */
    --nebula-transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    --nebula-transition-fast: all 0.15s cubic-bezier(0.4, 0, 0.2, 1);
    
    /* Legacy radius variables */
    --nebula-radius-sm: 6px;
    --nebula-radius: 8px;
    --nebula-radius-md: 8px;
    --nebula-radius-lg: 12px;
    --nebula-radius-xl: 16px;
    
    /* Legacy shadow variables */
    --nebula-shadow-sm: 0 2px 8px rgba(0, 0, 0, 0.15);
    --nebula-shadow-md: 0 4px 16px rgba(0, 0, 0, 0.25);
    --nebula-shadow-lg: 0 8px 32px rgba(0, 0, 0, 0.35);
    
    /* Legacy spacing */
    --nebula-space-xs: 4px;
    --nebula-space-sm: 8px;
    --nebula-space-md: 16px;
    --nebula-space-lg: 24px;
    --nebula-space-xl: 32px;
}

/* =============================================================================
 * WINDOW MANAGER THEME INTEGRATION
 * Ensures windows inherit the current theme properly
 * ============================================================================= */

/* Bridge enhanced themes to window manager variables */
.nebula-window,
.window-wrapper,
.window,
.window-content,
.window-header,
.window-titlebar,
.window-body {
    /* Core background colors */
    --window-bg: var(--nebula-surface, #ffffff);
    --window-content-bg: var(--nebula-bg-primary, #ffffff);
    --window-header-bg: var(--nebula-surface-elevated, #ffffff);
    --window-border-color: var(--nebula-border, #e2e8f0);
    
    /* Text colors */
    --window-text-color: var(--nebula-text-primary, #1a202c);
    --window-text-secondary: var(--nebula-text-secondary, #64748b);
    
    /* Control colors */
    --window-control-bg: var(--window-control-bg, #f1f5f9);
    --window-control-hover: var(--window-control-hover, #e2e8f0);
    --window-control-active: var(--window-control-active, #cbd5e1);
    --window-close-hover: var(--window-close-hover, #ef4444);
    --window-close-active: var(--window-close-active, #dc2626);
}

/* Window Titlebar Gradient Support */
.window-titlebar,
.nebula-window .window-titlebar {
    background: var(--nebula-surface-elevated, #ffffff) !important;
    /* Support for gradient titlebars with start and end colors */
    background: linear-gradient(
        90deg,
        var(--titlebar-start-color, var(--nebula-surface-elevated, #ffffff)),
        var(--titlebar-end-color, var(--nebula-surface-elevated, #ffffff))
    ) !important;
    border-bottom: 1px solid var(--nebula-border, #e2e8f0) !important;
    color: var(--nebula-text-primary, #1a202c) !important;
}

/* Titlebar-only mode special styling */
.nebula-window.titlebar-only .window-titlebar {
    background: rgba(0, 0, 0, 0.85) !important;
    /* Override with theme-aware gradient for titlebar-only mode */
    background: linear-gradient(
        90deg,
        var(--titlebar-start-color, rgba(0, 0, 0, 0.85)),
        var(--titlebar-end-color, rgba(0, 0, 0, 0.85))
    ) !important;
    color: rgba(255, 255, 255, 0.95) !important;
}

/* =============================================================================
 * TASKBAR & LAUNCHER INTEGRATION
 * Ensures taskbar elements use enhanced themes
 * ============================================================================= */

.taskbar,
.launcher,
.launcher-bg {
    background: var(--taskbar-bg, rgba(255, 255, 255, 0.95)) !important;
    border-color: var(--taskbar-border, rgba(0, 0, 0, 0.1)) !important;
    color: var(--nebula-text-primary, #1a202c) !important;
}

.launcher-content {
    background: var(--launcher-bg, rgba(255, 255, 255, 0.98)) !important;
    border-color: var(--launcher-border, rgba(0, 0, 0, 0.1)) !important;
}

/* =============================================================================
 * SPECIFIC APP BRIDGE STYLES
 * Ensures all apps and components respect enhanced theme colors
 * ============================================================================= */

/* Browser App Bridge */
.browser-container,
.browser-window,
.browser-nav,
.browser-toolbar,
.browser-sidebar,
.tab-list,
.browser-tab,
.new-tab-btn,
.browser-content,
.url-bar,
.nav-button {
    background: var(--nebula-surface, #ffffff) !important;
    color: var(--nebula-text-primary, #1a202c) !important;
    border-color: var(--nebula-border, #e2e8f0) !important;
}

.browser-tab.active {
    border-left-color: var(--nebula-primary, #667eea) !important;
}

.new-tab-btn:hover {
    color: var(--nebula-secondary, #764ba2) !important;
}

/* Terminal Bridge */
.terminal-container,
.xterm,
.xterm-viewport,
.xterm-screen,
.xterm-decoration-container {
    background: var(--nebula-bg-primary, #ffffff) !important;
    color: var(--nebula-text-primary, #1a202c) !important;
}

/* File Manager Bridge */
.filemanager-container,
.filemanager-sidebar,
.filemanager-content,
.file-area,
.sidebar-section,
.sidebar-item,
.file-item {
    background: var(--nebula-surface, #ffffff) !important;
    color: var(--nebula-text-primary, #1a202c) !important;
    border-color: var(--nebula-border, #e2e8f0) !important;
}

.sidebar-item.active,
.file-item.selected {
    background: var(--nebula-surface-active, #f1f5f9) !important;
    color: var(--nebula-primary, #667eea) !important;
}

/* Settings Bridge */
.settings-container,
.settings-panel,
.settings-section,
.theme-selector,
.theme-options {
    background: var(--nebula-surface, #ffffff) !important;
    color: var(--nebula-text-primary, #1a202c) !important;
    border-color: var(--nebula-border, #e2e8f0) !important;
}

/* Assistant Apps Bridge */
.assistant-container,
.chat-container,
.message-container,
.code-assistant-container,
.code-chat-side,
.code-toolbar,
.art-assistant-container {
    background: var(--nebula-surface, #ffffff) !important;
    color: var(--nebula-text-primary, #1a202c) !important;
    border-color: var(--nebula-border, #e2e8f0) !important;
}

/* NebulaApp Templates Bridge */
.myapp-container,
.myapp-toolbar,
.myapp-content,
.myapp-status,
.pwa-container,
.pwa-webview-container,
.context-menu {
    background: var(--nebula-surface, #ffffff) !important;
    color: var(--nebula-text-primary, #1a202c) !important;
    border-color: var(--nebula-border, #e2e8f0) !important;
}

/* Image Viewer Bridge */
.image-viewer-container,
.image-viewer-toolbar,
.image-viewer-content {
    background: var(--nebula-bg-primary, #ffffff) !important;
    color: var(--nebula-text-primary, #1a202c) !important;
    border-color: var(--nebula-border, #e2e8f0) !important;
}

/* Media Player Bridge */
.media-player-container,
.media-controls,
.media-timeline {
    background: var(--nebula-surface, #ffffff) !important;
    color: var(--nebula-text-primary, #1a202c) !important;
    border-color: var(--nebula-border, #e2e8f0) !important;
}

/* =============================================================================
 * WINDOW CONTROLS & BUTTONS BRIDGE
 * Ensures window controls inherit proper theme colors
 * ============================================================================= */

.window-controls,
.window-btn,
.window-button,
.close,
.minimize,
.maximize,
.pill {
    background: var(--window-control-bg, var(--nebula-surface-hover, #f1f5f9)) !important;
    color: var(--nebula-text-primary, #1a202c) !important;
    border-color: var(--nebula-border, #e2e8f0) !important;
}

.window-btn:hover,
.window-button:hover {
    background: var(--window-control-hover, var(--nebula-surface-active, #e2e8f0)) !important;
}

.window-btn.close:hover,
.window-button.close:hover,
.close:hover {
    background: var(--window-close-hover, #ef4444) !important;
    color: white !important;
}

.window-btn:active,
.window-button:active {
    background: var(--window-control-active, var(--nebula-border-hover, #cbd5e1)) !important;
}

/* Tab Bar Elements */
.window-tabbar,
.tab-item,
.tab-content {
    background: var(--nebula-bg-secondary, #f8fafc) !important;
    border-color: var(--nebula-border, #e2e8f0) !important;
    color: var(--nebula-text-primary, #1a202c) !important;
}

.tab-item.active {
    background: var(--nebula-surface, #ffffff) !important;
    color: var(--nebula-primary, #667eea) !important;
}

/* =============================================================================
 * TITLEBAR GRADIENT THEME MAPPINGS
 * Maps enhanced themes to titlebar start/end colors for gradient effects
 * ============================================================================= */

/* Light Theme Gradient */
[data-theme="light"] {
    --titlebar-start-color: #ffffff;
    --titlebar-end-color: #f8fafc;
}

/* Dark Theme Gradient */
[data-theme="dark"] {
    --titlebar-start-color: #1e293b;
    --titlebar-end-color: #334155;
}

/* Nebula-Slate Theme Gradient */
[data-theme="nebula-slate"] {
    --titlebar-start-color: #64748b;
    --titlebar-end-color: #475569;
}

/* Ocean Theme Gradient */
[data-theme="nebula-ocean"] {
    --titlebar-start-color: #1a3a52;
    --titlebar-end-color: #2d5a7a;
}

/* Forest Theme Gradient */
[data-theme="nebula-forest"] {
    --titlebar-start-color: #1a3d1a;
    --titlebar-end-color: #2d5a2d;
}

/* Sunset Theme Gradient */
[data-theme="nebula-sunset"] {
    --titlebar-start-color: #4a2f1a;
    --titlebar-end-color: #6b4226;
}

/* Midnight Theme Gradient */
[data-theme="nebula-midnight"] {
    --titlebar-start-color: #2d1a4a;
    --titlebar-end-color: #42266b;
}

/* Rose Theme Gradient */
[data-theme="nebula-rose"] {
    --titlebar-start-color: #4a1a2d;
    --titlebar-end-color: #6b2642;
}

/* Cyber Theme Gradient */
[data-theme="nebula-cyber"] {
    --titlebar-start-color: #0a0a0a;
    --titlebar-end-color: #1a1a1a;
}

/* Glass Theme Gradient */
[data-theme="nebula-glass"] {
    --titlebar-start-color: rgba(30, 41, 59, 0.80);
    --titlebar-end-color: rgba(51, 65, 85, 0.85);
}

/* Windows 11 Theme Gradient */
[data-theme="windows-11"] {
    --titlebar-start-color: #f3f3f3;
    --titlebar-end-color: #e1e1e1;
}

/* macOS Theme Gradient */
[data-theme="macos"] {
    --titlebar-start-color: #f5f5f7;
    --titlebar-end-color: #e5e5e7;
}

/* Volcano Theme Gradient */
[data-theme="nebula-volcano"] {
    --titlebar-start-color: #2d1a1a;
    --titlebar-end-color: #4a2a2a;
}

/* Arctic Theme Gradient */
[data-theme="nebula-arctic"] {
    --titlebar-start-color: #16213e;
    --titlebar-end-color: #1e3a5f;
}

/* Retro Theme Gradient */
[data-theme="nebula-retro"] {
    --titlebar-start-color: #1a0933;
    --titlebar-end-color: #2d1b69;
}

/* Ocean Theme Window Adjustments */
[data-theme="nebula-ocean"] .window,
[data-theme="nebula-ocean"] .window-wrapper {
    --window-primary-accent: #4a9eff;
    border-color: var(--nebula-border) !important;
}

/* Forest Theme Window Adjustments */
[data-theme="nebula-forest"] .window,
[data-theme="nebula-forest"] .window-wrapper {
    --window-primary-accent: #4ade80;
    border-color: var(--nebula-border) !important;
}

/* Sunset Theme Window Adjustments */
[data-theme="nebula-sunset"] .window,
[data-theme="nebula-sunset"] .window-wrapper {
    --window-primary-accent: #f97316;
    border-color: var(--nebula-border) !important;
}

/* Midnight Theme Window Adjustments */
[data-theme="nebula-midnight"] .window,
[data-theme="nebula-midnight"] .window-wrapper {
    --window-primary-accent: #8b5cf6;
    border-color: var(--nebula-border) !important;
}

/* Rose Theme Window Adjustments */
[data-theme="nebula-rose"] .window,
[data-theme="nebula-rose"] .window-wrapper {
    --window-primary-accent: #f43f5e;
    border-color: var(--nebula-border) !important;
}

/* Cyber Theme Window Adjustments */
[data-theme="nebula-cyber"] .window,
[data-theme="nebula-cyber"] .window-wrapper {
    --window-primary-accent: #00ffff;
    border-color: var(--nebula-border) !important;
}

/* Glass Theme Window Adjustments */
[data-theme="nebula-glass"] .window,
[data-theme="nebula-glass"] .window-wrapper {
    background: var(--nebula-surface) !important;
    backdrop-filter: blur(20px);
    -webkit-backdrop-filter: blur(20px);
    border-color: var(--nebula-border) !important;
}

/* Windows 11 Theme Adjustments */
[data-theme="windows-11"] .window,
[data-theme="windows-11"] .window-wrapper {
    --window-primary-accent: #0078d4;
    border-radius: 8px !important;
    border-color: var(--nebula-border) !important;
}

/* macOS Theme Adjustments */
[data-theme="macos"] .window,
[data-theme="macos"] .window-wrapper {
    --window-primary-accent: #007aff;
    border-radius: 12px !important;
    border-color: var(--nebula-border) !important;
}

/* =============================================================================
 * FALLBACK & COMPATIBILITY
 * Ensures backwards compatibility with older components
 * ============================================================================= */

/* Fallback for components that use old class-based theming */
.light-theme,
.dark-theme,
.nebula-slate-theme {
    background: var(--nebula-bg-primary) !important;
    color: var(--nebula-text-primary) !important;
}

/* Ensure scrollbars match theme */
::-webkit-scrollbar {
    background: var(--nebula-bg-secondary) !important;
}

::-webkit-scrollbar-thumb {
    background: var(--nebula-border) !important;
    border-radius: var(--nebula-radius-sm) !important;
}

::-webkit-scrollbar-thumb:hover {
    background: var(--nebula-border-hover) !important;
}

/* =============================================================================
 * DEBUGGING HELPERS
 * Helpful classes for debugging theme issues
 * ============================================================================= */

/* Add to any element to see current theme variables */
.debug-theme::before {
    content: "Theme: " attr(data-theme) " | BG: " var(--nebula-bg-primary) " | Text: " var(--nebula-text-primary);
    position: absolute;
    top: 0;
    left: 0;
    background: rgba(255, 0, 0, 0.8);
    color: white;
    padding: 2px 4px;
    font-size: 10px;
    z-index: 10000;
    pointer-events: none;
}

/* Force theme inheritance */
.force-theme-inheritance * {
    background: inherit !important;
    color: inherit !important;
    border-color: var(--nebula-border) !important;
}

/* =============================================================================
 * IMPORTANT NOTES
 * 
 * 1. Load this CSS AFTER nebula-extended-themes.css
 * 2. This bridge ensures ALL components use enhanced theme colors
 * 3. Uses !important sparingly but necessarily for stubborn legacy styles
 * 4. All enhanced themes now properly affect windows and all components
 * 5. Maintains backwards compatibility with original theme system
 * 
 * Load order should be:
 * 1. style.css
 * 2. nebula-theme.css  
 * 3. nebula-extended-themes.css
 * 4. nebula-theme-bridge.css (this file)
 * ============================================================================= */